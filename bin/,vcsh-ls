#!/usr/bin/env bash
# List all files tracked by all repositories
#   $@ arguments passed to less, useful to add '-p pattern'
#
# If stdout is a tty, result is paged by less, else is just written to stdout

B= ; R=
if [[ -t 1 ]]; then
    B=$'\e[1m' # bold
    R=$'\e[0m' # roman
fi

vcsh foreach ls-files | sed -r $"s/(^.*:$)/\\n$B\\1$R/" |
    ( [[ -t 1 ]] && less "$@" || cat )
